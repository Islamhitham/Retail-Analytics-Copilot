{
  "generate.predict": {
    "traces": [],
    "train": [],
    "demos": [
      {
        "augmented": true,
        "question": "What is the total revenue from Orders?",
        "db_schema": "orders (OrderID, CustomerID, EmployeeID, OrderDate, ...), order_items (OrderID, ProductID, UnitPrice, Quantity, Discount), ...",
        "constraints": "",
        "reasoning": "To calculate the total revenue from Orders, we need to sum up all the revenues generated by each order item. The revenue per order item is calculated as UnitPrice multiplied by Quantity and then adjusted for any Discount applied (Revenue = UnitPrice * Quantity * (1 - Discount)). We will join the `orders` table with the `order_items` table on OrderID to access all relevant data in a single query.",
        "sql_query": "SELECT SUM(o.UnitPrice * oi.Quantity * (1 - oi.Discount)) AS TotalRevenue FROM orders AS o JOIN order_items AS oi ON o.OrderID = oi.OrderID;"
      },
      {
        "augmented": true,
        "question": "List top 5 products by unit price.",
        "db_schema": "products (ProductID, ProductName, SupplierID, CategoryID, UnitPrice, ...)",
        "constraints": "",
        "reasoning": "To find the top 5 products by unit price, we need to perform a query that selects product names along with their corresponding prices from the 'products' table. We will order these results in descending order based on the UnitPrice column and limit the output to only show the first five records using the LIMIT clause.",
        "sql_query": "SELECT ProductName, UnitPrice FROM products ORDER BY UnitPrice DESC LIMIT 5;"
      },
      {
        "augmented": true,
        "question": "How many customers are from UK?",
        "db_schema": "customers (CustomerID, CompanyName, Country, ...)",
        "constraints": "",
        "reasoning": "To determine how many customers are from the UK, we need to count distinct CustomerIDs in the 'customers' table where the Country field is equal to \"UK\". This will give us a unique list of customer IDs that come from the United Kingdom. The COUNT function can be used here with a WHERE clause for filtering based on the country criterion.",
        "sql_query": "SELECT COUNT(DISTINCT CustomerID) FROM customers WHERE Country = 'UK';"
      },
      {
        "augmented": true,
        "question": "What is the average order value?",
        "db_schema": "orders (OrderID, ...), order_items (OrderID, UnitPrice, Quantity, Discount)",
        "constraints": "AOV = SUM(UnitPrice * Quantity * (1 - Discount)) / COUNT(DISTINCT OrderID)",
        "reasoning": "To calculate the average order value (AOV), we need to sum up all individual orders' revenues while taking into account each item'InstanceIDs UnitPrice, Quantity and Discount. Then divide this total revenue by the count of unique Order IDs in the database. The SQL query will perform these calculations across both 'orders' and 'order_items' tables using a JOIN to correlate related records based on their shared 'OrderID'.",
        "sql_query": "SELECT SUM(o1.UnitPrice * o1.Quantity * (1 - IFNULL(i1.Discount, 0))) / COUNT(DISTINCT o1.OrderID) as AverageOrderValue FROM order_items AS i1 JOIN orders AS o1 ON i1.OrderID = o1.OrderID"
      }
    ],
    "signature": {
      "instructions": "Generate a valid SQLite query to answer the question based on the schema and constraints.\n\nUse the provided schema and constraints. \n- Use 'orders', 'order_items', 'products', 'customers' views/tables.\n- Revenue = SUM(UnitPrice * Quantity * (1 - Discount)).\n- AOV = SUM(Revenue) / COUNT(DISTINCT OrderID).\n- Gross Margin = SUM((UnitPrice - CostOfGoods) * Quantity * (1 - Discount)).\n- If CostOfGoods is missing, assume 0.7 * UnitPrice.",
      "fields": [
        {
          "prefix": "Question:",
          "description": "The user's question."
        },
        {
          "prefix": "Db Schema:",
          "description": "Schema of the available tables/views."
        },
        {
          "prefix": "Constraints:",
          "description": "Constraints and definitions extracted from documents."
        },
        {
          "prefix": "Reasoning: Let's think step by step in order to",
          "description": "${reasoning}"
        },
        {
          "prefix": "Sql Query:",
          "description": "The SQLite query to execute."
        }
      ]
    },
    "lm": null
  },
  "metadata": {
    "dependency_versions": {
      "python": "3.10",
      "dspy": "3.0.4",
      "cloudpickle": "3.1"
    }
  }
}
