{
  "generate.predict": {
    "traces": [],
    "train": [],
    "demos": [
      {
        "augmented": true,
        "question": "What is the total revenue from Orders?",
        "db_schema": "Orders (OrderID, CustomerID, EmployeeID, OrderDate), \"Order Details\" (OrderID, ProductID, UnitPrice, Quantity, Discount)",
        "constraints": "Revenue = SUM(UnitPrice * Quantity * (1 - Discount))",
        "reasoning": "To calculate the total revenue from all orders within the database schema provided, we need to perform a join between the 'Orders' table and the \"Order Details\" view. This will allow us to access each order line item (UnitPrice, Quantity, Discount) necessary for calculating individual revenues before summing them up across all orders.",
        "sql_query": "SELECT SUM(od.UnitPrice * od.Quantity * (1 - IFNULL(od.Discount, 0))) as total_revenue FROM Orders o JOIN \"Order Details\" od ON o.OrderID = od.OrderID;"
      },
      {
        "augmented": true,
        "question": "List top 5 products by unit price.",
        "db_schema": "Products (ProductID, ProductName, UnitPrice, CategoryID)",
        "constraints": "",
        "reasoning": "To list the top 5 products by unit price, we need to order the products based on their UnitPrice in descending order. The query should select all relevant columns from the Products table and limit the results to the first 5 entries after sorting them accordingly.",
        "sql_query": "SELECT * FROM Products ORDER BY UnitPrice DESC LIMIT 5;"
      },
      {
        "augmented": true,
        "question": "Top 3 products by total revenue all-time.",
        "db_schema": "Products (ProductID, ProductName), \"Order Details\" (OrderID, ProductID, UnitPrice, Quantity, Discount)",
        "constraints": "Revenue = SUM(UnitPrice * Quantity * (1 - Discount))",
        "reasoning": "To find the top 3 products by total revenue all-time, we need to calculate the revenue generated from each product across all orders. This involves joining the 'Products' and \"Order Details\" tables on ProductID, then aggregating (SUM) the calculated revenues for each product while ordering them in descending order based on their total revenue. The query will limit the results to only show the top 3 products with the highest revenue figures.",
        "sql_query": "SELECT p.ProductName, SUM(od.UnitPrice * od.Quantity * (1 - od.Discount)) as TotalRevenue\nFROM Products p JOIN \"Order Details\" od ON p.ProductID = od.ProductID\nGROUP BY p.ProductID, p.ProductName\nORDER BY TotalRevenue DESC\nLIMIT 3;"
      },
      {
        "augmented": true,
        "question": "What was the Average Order Value during Winter Classics 1997 (Dec 1-31)?",
        "db_schema": "Orders (OrderID, OrderDate), \"Order Details\" (OrderID, UnitPrice, Quantity, Discount)",
        "constraints": "AOV = SUM(UnitPrice * Quantity * (1 - Discount)) / COUNT(DISTINCT OrderID), Dates: 1997-12-01 to 1997-12-31",
        "reasoning": "To calculate the Average Order Value (AOV) during Winter Classics in December of 1997, we need to sum up all revenues from orders placed within this date range and then divide by the count of distinct order IDs. This will give us an average value for each completed sale made in that period.",
        "sql_query": "SELECT ROUND(SUM(od.UnitPrice * od.Quantity * (1 - od.Discount)) / COUNT(DISTINCT o.OrderID), 2) as AverageOrderValue FROM Orders o JOIN \"Order Details\" od ON o.OrderID = od.OrderID WHERE strftime('%Y-%m-%d', o.OrderDate) BETWEEN '1997-12-01' AND '1997-12-31';"
      }
    ],
    "signature": {
      "instructions": "Generate a valid SQLite query to answer the question based on the schema and constraints.\n\nUse the provided schema and constraints. \n- Use 'orders', 'order_items', 'products', 'customers' views/tables.\n- Revenue = SUM(UnitPrice * Quantity * (1 - Discount)).\n- AOV = SUM(Revenue) / COUNT(DISTINCT OrderID).\n- Gross Margin = SUM((UnitPrice - CostOfGoods) * Quantity * (1 - Discount)).\n- If CostOfGoods is missing, assume 0.7 * UnitPrice.",
      "fields": [
        {
          "prefix": "Question:",
          "description": "The user's question."
        },
        {
          "prefix": "Db Schema:",
          "description": "Schema of the available tables/views."
        },
        {
          "prefix": "Constraints:",
          "description": "Constraints and definitions extracted from documents."
        },
        {
          "prefix": "Reasoning: Let's think step by step in order to",
          "description": "${reasoning}"
        },
        {
          "prefix": "Sql Query:",
          "description": "The SQLite query to execute."
        }
      ]
    },
    "lm": null
  },
  "metadata": {
    "dependency_versions": {
      "python": "3.11",
      "dspy": "3.0.4",
      "cloudpickle": "3.1"
    }
  }
}
